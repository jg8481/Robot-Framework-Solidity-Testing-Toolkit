name: Toolkit Checks
on:  
  push:
  pull_request:
  schedule:
      - cron: '0 0 1 * *'

jobs:

  run-security-checks:
    runs-on: ubuntu-latest
    timeout-minutes: 60    
    steps:
      - name: Check out repository code
        uses: actions/checkout@v3
      - name: Install all ShellCheck dependencies
        run: |
          sudo apt update
          apt-get install shellcheck
      - name: Run ShellCheck on all Bash scripts
        run: |
          ls -la
          shellcheck ./*.sh | grep "(error)"
          if [ $? -eq 1 ]; then
            echo
            echo "ShellCheck did not discover any serious problems."
            echo
            exit 0
          else 
            echo
            echo "WARNING! ShellCheck discovered serious problems."
            echo
            exit 1
          fi

  run-unit-tests:
    runs-on: ubuntu-latest
    timeout-minutes: 60    
    steps:
      - name: Check out repository code
        uses: actions/checkout@v3
      - name: Install all required Robot Framework dependencies
        run: |
          sudo apt update && sudo apt upgrade -y
          sudo apt install software-properties-common -y
          sudo add-apt-repository ppa:deadsnakes/ppa -y
          sudo apt install python3.10
          python3 --version
          ls -la
          pip3 install -r ./solidity-hardhat-multichain-tools/requirements.txt
          pip freeze
          robot --nostatusrc --help | grep "Robot Framework is open source software"
          robot --nostatusrc --version | grep "Robot"
      - name: Install NodeJS and all required Hardhat dependencies
        run: |
          ls -la
          bash ./start-solidity-qa-workflows.sh Install-Tools-On-MacOS-Or-Linux
          node --version
      - name: Run all unit tests using the BATS test framework
        run: |
          ls -la
          bash ./start-maintenance-workflows.sh Run-Unit-Tests

  run-acceptance-tests:
    runs-on: ubuntu-latest
    timeout-minutes: 60    
    steps:
      - name: Check out repository code
        uses: actions/checkout@v3
      - name: Install all required Robot Framework dependencies
        run: |
          sudo apt update && sudo apt upgrade -y
          sudo apt install software-properties-common -y
          sudo add-apt-repository ppa:deadsnakes/ppa -y
          sudo apt install python3.10
          python3 --version
          ls -la
          pip3 install -r ./solidity-hardhat-multichain-tools/requirements.txt
          pip freeze
          robot --nostatusrc --help | grep "Robot Framework is open source software"
          robot --nostatusrc --version | grep "Robot"
      - name: Install NodeJS and all required Hardhat dependencies
        run: |
          ls -la
          bash ./start-solidity-qa-workflows.sh Install-Tools-On-MacOS-Or-Linux
          node --version
      - name: Run all acceptance tests using the BATS test framework
        run: |
          ls -la
          bash ./start-maintenance-workflows.sh Run-Acceptance-Tests